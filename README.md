Customer Appeals Moderation System
 –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∑–µ —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –≤–∏–¥–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ Kafka, –æ–±–æ–≥–∞—â–∞–µ—Ç –∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –æ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:

First Service ‚Äî —Å–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π

Second Service ‚Äî —Å–µ—Ä–≤–∏—Å –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Redis

 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
Client / Test API
        ‚Üì
Kafka (Topic-1)
        ‚Üì
First Service (Moderation)
        ‚Üì
REST
        ‚Üì
Second Service (Enrichment)
        ‚Üì
Redis
        ‚Üì
First Service (Rules)
        ‚Üì
Kafka (Topic-2)
 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
kaspiproject
‚îÇ
‚îú‚îÄ‚îÄ libs
‚îÇ   ‚îî‚îÄ‚îÄ common-dto          # –û–±—â–∏–µ DTO –¥–ª—è Kafka –∏ REST
‚îÇ
‚îú‚îÄ‚îÄ services
‚îÇ   ‚îú‚îÄ‚îÄ firstService        # –°–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (Kafka consumer/producer)
‚îÇ   ‚îî‚îÄ‚îÄ secondService       # –°–µ—Ä–≤–∏—Å –æ–±–æ–≥–∞—â–µ–Ω–∏—è + Redis
‚îÇ
‚îî‚îÄ‚îÄ infrastructure
    ‚îî‚îÄ‚îÄ docker-compose.yml  # Kafka, Redis, Zookeeper, Kafka UI
 –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

Java 21

Spring Boot 3

Spring Kafka

Apache Kafka

Redis

Docker / Docker Compose

Maven

Jackson

Lombok

 –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

–í First Service —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è —Å —Ç–µ–º –∂–µ eventId –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ.

–ù–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
–ï—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî —Å–æ–±—ã—Ç–∏–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è.

–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π URGENT –∏ COMPLAINT –æ–±—Ä–∞—â–µ–Ω–∏—è, –ø–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –≤–Ω–µ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞
–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞ BLOCKED, –æ–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è.

–ï—Å–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Kafka Topic-2.

 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–í—ã–∑–æ–≤ Second Service –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ REST —Å retry-–º–µ—Ö–∞–Ω–∏–∑–º–æ–º

–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Second Service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback-–æ—Ç–≤–µ—Ç

Fallback —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ First Service –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É

 –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
1Ô∏è‚É£ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

Java 21

Maven 3.9+

Docker

Docker Compose

2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Kafka + Redis)

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å docker-compose:

cd infrastructure
docker compose up -d

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:

docker compose ps

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:

Kafka

Zookeeper

Redis

(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Kafka UI

3Ô∏è‚É£ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

mvn clean install
4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
üîπ –ó–∞–ø—É—Å–∫ Second Service (—Å–Ω–∞—á–∞–ª–∞!)
cd services/secondService
mvn spring-boot:run

–°–µ—Ä–≤–∏—Å –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8081.

–ü—Ä–æ–≤–µ—Ä–∫–∞:

GET http://localhost:8081/api/v1/appeals/health

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

Service-2 is UP
 –ó–∞–ø—É—Å–∫ First Service

–í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

cd services/firstService
mvn spring-boot:run

–°–µ—Ä–≤–∏—Å –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8080.

 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
1Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
POST http://localhost:8080/api/send/appeal

–†–µ–∑—É–ª—å—Ç–∞—Ç:

—Å–æ–±—ã—Ç–∏–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Kafka Topic-1

–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏

–ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Topic-2

2Ô∏è‚É£ –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π (–Ω–∞–≥—Ä—É–∑–∫–∞)
POST http://localhost:8080/api/send/bulk?count=100

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

–ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (100 rps)

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö First Service:

rejected: client has active appeals

rejected: outside working hours

already processed, skipping

approved and sent to topic-2

4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis

–ß–µ—Ä–µ–∑ docker:

docker exec -it insfrastructure-redis-1 redis-cli

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–ª—é—á–∏:

KEYS *

–ü—Ä–∏–º–µ—Ä –∫–ª—é—á–µ–π:

appeal:<eventId>

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ:

GET appeal:<eventId>

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL:

TTL appeal:<eventId>
 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ 100 rps –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞ —Å—á—ë—Ç:

–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ Kafka

consumer group –≤ First Service

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Redis –∫–∞–∫ in-memory –∫—ç—à–∞

–æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –≥–æ—Ä—è—á–µ–º –ø—É—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
